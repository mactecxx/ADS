<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canada Visa Support</title>
    <link rel="stylesheet" href="chat-style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Master Shell Layout */
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
        #app-frame { 
            width: 100%; 
            height: 100%; 
            border: none; 
            display: block; 
        }
    </style>
</head>
<body>

    <iframe id="app-frame" src="home.html"></iframe>

    <div class="support-trigger-wrapper" id="support-wrapper">
        <div class="support-btn-group">
            <button class="btn-3d" onclick="triggerAnimation('chat')">ðŸ’¬ Text Chat</button>
            <button class="btn-3d" onclick="triggerAnimation('call')">ðŸ“ž Voice Call</button>
        </div>
        <div class="floating-support-btn" onclick="toggleSupportMenu()">
            <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
        </div>
    </div>

    <div id="cvd-panel">
        <div class="panel-header">
            <span>Customer Support</span>
            <span style="cursor:pointer; font-size:20px;" onclick="closePanel()">âœ•</span>
        </div>

        <div id="auth-view">
            <h3 style="text-align:center; color:#334155;">Welcome</h3>
            <p style="text-align:center; font-size:13px; color:#64748b;">Enter details to start.</p>
            <input type="text" id="chat-name" class="cvd-input" placeholder="Full Name">
            <input type="email" id="chat-email" class="cvd-input" placeholder="Email Address">
            <input type="date" id="chat-dob" class="cvd-input">
            <button class="cvd-btn" onclick="handleChatLogin()">Start Conversation</button>
            <div id="login-status" style="text-align:center; font-size:12px; margin-top:10px;"></div>
        </div>

        <div id="chat-view">
            <div id="active-call-strip" style="display:none; background:#1e293b; padding:10px; color:white; justify-content:space-between; align-items:center;">
                <span id="call-timer">00:00</span>
                <div style="display:flex; gap:5px;">
                    <button class="c-btn c-end" style="width:30px; height:30px; font-size:12px;" onclick="endCall()">X</button>
                </div>
            </div>

            <div class="msgs-area" id="msgs-area"></div>

            <div class="input-area">
                <input type="file" id="file-input" hidden onchange="uploadFile(this)">
                <button class="file-btn" onclick="triggerFileSelect()">ðŸ“Ž</button>
                <input type="text" id="msg-input" class="cvd-input" style="flex:1;" placeholder="Type a message...">
                <button class="cvd-btn" style="width:auto;" onclick="sendMsg()">âž¤</button>
            </div>
        </div>
    </div>

    <div id="call-modal">
        <h3 id="call-status-text">Calling Support...</h3>
        <div class="call-btn-group">
            <button class="c-btn c-mute" onclick="toggleMute()">ðŸŽ¤</button>
            <button class="c-btn c-screen" onclick="shareScreen()">ðŸ–¥</button>
            <button class="c-btn c-end" onclick="endCall()">âœ–</button>
        </div>
    </div>

    <div id="file-modal">
        <span class="close-file-btn" onclick="closeFileModal()">Ã—</span>
        <div id="file-modal-content"></div>
    </div>

    <script src="config.js"></script>
    <script src="client-logic.js"></script>
</body>
</html>
