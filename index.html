<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canada Visa Data Support</title>
    <link rel="stylesheet" href="chat-style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
        #site-frame { width: 100%; height: 100%; border: none; }
        #overlay-layer { position: absolute; top: 0; left: 0; width: 0; height: 0; z-index: 9999; }
    </style>
</head>
<body>

    <iframe id="site-frame" src="home_content.html"></iframe>

    <div id="overlay-layer">
        
        <div class="support-trigger-wrapper" onclick="toggleSupportMenu()">
            <div class="support-btn-group">
                <button class="btn-3d" onclick="triggerAnimation('chat')">Text Chat</button>
                <button class="btn-3d" onclick="triggerAnimation('call')">Voice Call</button>
            </div>
            <div class="floating-support-btn">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
            </div>
        </div>

        <div id="cvd-panel">
            <div class="panel-header">
                <span>Support Team</span>
                <span style="cursor:pointer" onclick="closePanel()">âœ•</span>
            </div>
            
            <div id="auth-view">
                <h3 style="color:#334155; text-align:center">Welcome</h3>
                <input type="text" id="chat-name" class="cvd-input" placeholder="Your Name">
                <input type="email" id="chat-email" class="cvd-input" placeholder="Your Email">
                <input type="date" id="chat-dob" class="cvd-input" placeholder="Date of Birth">
                <button class="cvd-btn" onclick="handleChatLogin()">Start Conversation</button>
                <p style="font-size:11px; color:#64748b; text-align:center; margin-top:10px;">
                    Returning users will receive a verification link.
                </p>
            </div>

            <div id="chat-view">
                <div style="padding:10px; border-bottom:1px solid #e2e8f0; display:flex; gap:10px; justify-content:center;">
                    <button onclick="startCall()" class="cvd-btn" style="padding:5px 10px; font-size:12px;">ðŸ“ž Call</button>
                    <button onclick="shareScreen()" class="cvd-btn" style="padding:5px 10px; font-size:12px; background:#0ea5e9;">ðŸ–¥ Screen</button>
                </div>
                
                <div id="call-active-banner" style="display:none; background:#1e293b; color:white; padding:8px; align-items:center; justify-content:between;">
                    <span id="call-timer">00:00</span>
                    <div style="display:flex; gap:5px;">
                        <button onclick="toggleMute()" id="btn-mute-mini" style="font-size:10px;">Mute</button>
                        <button onclick="endCall()" style="background:#ef4444; border:none; color:white; font-size:10px; padding:2px 5px;">End</button>
                    </div>
                </div>

                <div class="msgs-area" id="msgs-area"></div>
                
                <div class="input-area">
                    <button class="file-btn" onclick="triggerFileSelect()">ðŸ“Ž</button>
                    <input type="file" id="file-input" hidden onchange="uploadFile(this)">
                    <input type="text" id="msg-input" placeholder="Type a message..." style="flex:1; border:none; outline:none;">
                    <button class="cvd-btn" onclick="sendMsg()" style="padding:8px 15px;">âž¤</button>
                </div>
            </div>
        </div>

        <div id="call-modal">
            <h3 id="call-status-text">Connecting...</h3>
            <div class="call-btn-group">
                <button class="c-btn c-mute" onclick="toggleMute()">ðŸŽ¤</button>
                <button class="c-btn c-screen" onclick="shareScreen()">ðŸ–¥</button>
                <button class="c-btn c-end" onclick="endCall()">Phone Down</button>
            </div>
        </div>

        <div id="file-modal">
            <button class="close-file-btn" onclick="closeFileModal()">Ã—</button>
            <div id="file-modal-content"></div>
        </div>

    </div>

    <script src="client-logic.js"></script>
</body>
</html>
